<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ… ê¸°ë¡ - Tupick</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="main.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        :root {
            --primary: #3B82F6;
            --primary-dark: #2563EB;
            --text: #1F2937;
            --text-light: #6B7280;
            --border: #E5E7EB;
            --bg-light: #F8FAFC;
            --shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
            --radius: 12px;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text);
            line-height: 1.6;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ - features.htmlê³¼ ë™ì¼ */
        .navbar {
            background: white;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            transition: all 0.3s ease;
            border-bottom: 1px solid var(--border);
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-logo {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: center;
        }

        .nav-logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0;
            line-height: 1.2;
        }
        
        .logo-subtitle {
            font-size: 0.875rem;
            color: var(--text-light);
            margin: 0;
            line-height: 1.2;
            margin-top: 4px;
        }
        
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .nav-link {
            text-decoration: none;
            color: var(--text-light);
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--primary);
        }
        
        .nav-button {
            background: var(--primary);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: background 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .nav-button:hover {
            background: var(--primary-dark);
        }

        #user-name {
            margin-right: 1rem;
            color: var(--text-light);
            text-decoration: none;
            cursor: pointer;
            font-weight: 500;
            transition: color 0.3s ease;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        #user-name:hover {
            color: var(--primary);
            background: rgba(59, 130, 246, 0.1);
        }

        #settings-link {
            display: none;
            transition: color 0.3s ease;
            font-size: 0.9rem;
        }

        #settings-link:hover {
            color: var(--primary);
        }

        /* ì±„íŒ… ê¸°ë¡ ë©”ì¸ ì½˜í…ì¸  */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 20px 40px;
        }

        .page-header {
            background: white;
            color: var(--text);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            color: var(--text);
        }

        .subtitle {
            font-size: 1.125rem;
            color: var(--text-light);
        }

        .main-content {
            display: flex;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            min-height: 600px;
        }

        /* ì±„íŒ… ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .chat-list {
            width: 35%;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .list-header {
            padding: 24px;
            background: var(--bg-light);
            border-bottom: 1px solid var(--border);
        }

        .list-header h2 {
            font-size: 1.25rem;
            margin-bottom: 8px;
            color: var(--text);
        }

        .list-header p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .search-box {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-box input:focus {
            border-color: var(--primary);
        }

        .chats {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .chat-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: flex-start;
        }

        .chat-item:hover {
            background-color: var(--bg-light);
        }

        .chat-item.active {
            background-color: rgba(59, 130, 246, 0.05);
            border-left: 4px solid var(--primary);
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .chat-info {
            flex: 1;
        }

        .chat-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
            color: var(--text);
        }

        .chat-preview {
            font-size: 13px;
            color: var(--text-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .chat-date {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
        }

        /* ì±„íŒ… ë‚´ìš© ìŠ¤íƒ€ì¼ */
        .chat-detail {
            width: 65%;
            display: flex;
            flex-direction: column;
        }

        .detail-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            background: var(--bg-light);
        }

        .detail-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .detail-info h3 {
            font-size: 1.125rem;
            margin-bottom: 4px;
            color: var(--text);
        }

        .detail-info p {
            font-size: 14px;
            color: var(--text-light);
        }

        .chat-messages {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background-color: var(--bg-light);
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
        }

        .message.received .message-content {
            background-color: white;
            border-radius: 0 18px 18px 18px;
            box-shadow: var(--shadow);
        }

        .message.sent {
            flex-direction: row-reverse;
        }

        .message.sent .message-content {
            background-color: #e3f2fd;
            border-radius: 18px 0 18px 18px;
            box-shadow: var(--shadow);
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin: 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }

        .sent .message-avatar {
            background: var(--primary);
        }

        .received .message-avatar {
            background: #4ECDC4;
        }

        .message-content {
            padding: 12px 16px;
            max-width: 70%;
        }

        .message-text {
            margin-bottom: 5px;
            line-height: 1.5;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-light);
            text-align: right;
        }

        .message.sent .message-time {
            text-align: left;
        }

        .no-chat {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-light);
            text-align: center;
            padding: 40px 20px;
        }

        .no-chat i {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--border);
        }

        .delete-btn {
            background: #EF4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .delete-btn:hover {
            background: #DC2626;
            transform: translateY(-2px);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: var(--border);
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .nav-menu {
                gap: 1rem;
            }
            
            .nav-link {
                font-size: 0.8rem;
            }
            
            .nav-button {
                padding: 0.4rem 1rem;
                font-size: 0.8rem;
            }

            .nav-logo h1 {
                font-size: 1.3rem;
            }

            .logo-subtitle {
                font-size: 0.7rem;
            }

            .container {
                padding: 90px 1rem 2rem;
            }

            .main-content {
                flex-direction: column;
            }

            .chat-list,
            .chat-detail {
                width: 100%;
            }

            .chat-detail {
                height: 60vh;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            h1 {
                font-size: 1.5rem;
            }

            .subtitle {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” (features.htmlê³¼ ë™ì¼) -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h1>Tupick</h1>
                <span class="logo-subtitle">ì¡°ê°íˆ¬ì AI ë¶„ì„</span>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">í™ˆ</a>
                <a href="features.html" class="nav-link">ê¸°ëŠ¥</a>
                <a href="how-it-works.html" class="nav-link">ì‘ë™ë°©ì‹</a>
                <a href="about.html" class="nav-link">ì„œë¹„ìŠ¤ ì†Œê°œ</a>
                <a href="profile.html" class="nav-link" id="settings-link" style="display: none;">âš™ï¸ ë‚´ ì„¤ì •</a>
                <div id="auth-section">
                    <a href="login.html" class="nav-button" id="login-button">ë¡œê·¸ì¸</a>
                    <div id="user-menu" style="display: none; align-items: center;">
                        <a href="profile-history.html" id="user-name"
                            style="margin-right: 1rem; color: #6B7280; text-decoration: none; cursor: pointer; font-weight: 500;"></a>
                        <button onclick="logout()" class="nav-button" style="background: #EF4444;">ë¡œê·¸ì•„ì›ƒ</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ì±„íŒ… ê¸°ë¡ ë©”ì¸ ì½˜í…ì¸  -->
    <div class="container">
        <div class="page-header">
            <div class="header-content">
                <div>
                    <h1>ì±„íŒ… ê¸°ë¡</h1>
                    <p class="subtitle">ì§€ë‚œ ëŒ€í™”ë¥¼ í™•ì¸í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- ì±„íŒ… ëª©ë¡ ì˜ì—­ -->
            <div class="chat-list">
                <div class="list-header">
                    <h2>ëŒ€í™” ëª©ë¡</h2>
                    <p>ìµœê·¼ ëŒ€í™”í•œ ê¸°ë¡ë“¤ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                </div>

                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ëŒ€í™” ê¸°ë¡ ê²€ìƒ‰...">
                </div>

                <div class="chats" id="chatList">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>ì±„íŒ… ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>

            <!-- ì±„íŒ… ë‚´ìš© ì˜ì—­ -->
            <div class="chat-detail">
                <div class="detail-header">
                    <div class="detail-avatar">AI</div>
                    <div class="detail-info">
                        <h3 id="chatTitle">ëŒ€í™”ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                        <p id="chatInfo">ì™¼ìª½ì—ì„œ ëŒ€í™”ë¥¼ ì„ íƒí•˜ì—¬ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”</p>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="no-chat">
                        <i>ğŸ’¬</i>
                        <h3>ëŒ€í™”ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                        <p>ì™¼ìª½ ëª©ë¡ì—ì„œ í™•ì¸í•˜ê³  ì‹¶ì€ ëŒ€í™”ë¥¼ ì„ íƒí•˜ì‹œë©´<br>í•´ë‹¹ ëŒ€í™” ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤í¬ë¡¤ íš¨ê³¼
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            if (navbar && window.scrollY > 100) {
                navbar.style.background = 'rgba(255, 255, 255, 0.95)';
                navbar.style.backdropFilter = 'blur(10px)';
            } else if (navbar) {
                navbar.style.background = 'white';
                navbar.style.backdropFilter = 'none';
            }
        });

        // ì¸ì¦ ìƒíƒœ ì—…ë°ì´íŠ¸ (features.htmlê³¼ ë™ì¼)
        function updateAuthUI() {
            const token = localStorage.getItem('access_token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            const authSection = document.getElementById('auth-section');
            const settingsLink = document.getElementById('settings-link');
            const loginButton = document.getElementById('login-button');
            const userMenu = document.getElementById('user-menu');
            const userName = document.getElementById('user-name');
            
            if (!authSection) {
                console.warn('auth-section ì—†ìŒ');
                return;
            }
            
            if (token && user.email) {
                if (loginButton) loginButton.style.display = 'none';
                if (userMenu) userMenu.style.display = 'flex';
                if (userName) userName.textContent = `${user.name || user.email}ë‹˜`;
                if (settingsLink) settingsLink.style.display = 'block';
            } else {
                if (loginButton) loginButton.style.display = 'block';
                if (userMenu) userMenu.style.display = 'none';
                if (settingsLink) settingsLink.style.display = 'none';
            }
        }

        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('access_token');
                localStorage.removeItem('user');
                window.location.href = '/';
            }
        }

        function handleAuthRedirect() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const userEmail = urlParams.get('user');
    
            if (token && userEmail) {
                localStorage.setItem('access_token', token);
                const tempUser = {
                    email: userEmail,
                    name: userEmail.split('@')[0]
                };
                localStorage.setItem('user', JSON.stringify(tempUser));
                updateAuthUI();
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // ì±„íŒ… ê¸°ë¡ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function getToken() {
            return localStorage.getItem('access_token') || sessionStorage.getItem('access_token');
        }

        async function loadChatHistory() {
            try {
                const token = getToken();
                const headers = {};

                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                // ì‹¤ì œ API í˜¸ì¶œ ëŒ€ì‹  ë”ë¯¸ ë°ì´í„° ì‚¬ìš© (ê°œë°œìš©)
                setTimeout(() => {
                    const dummyData = [
                        {
                            id: '1',
                            timestamp: new Date(Date.now() - 86400000).toISOString(),
                            messages: [
                                {
                                    role: 'user',
                                    content: 'ì¡°ê°íˆ¬ìì— ëŒ€í•´ ì•Œë ¤ì£¼ì„¸ìš”',
                                    timestamp: new Date(Date.now() - 86400000).toISOString()
                                },
                                {
                                    role: 'assistant',
                                    content: 'ì¡°ê°íˆ¬ìëŠ” ê³ ê°€ì˜ ìì‚°ì„ ì‘ì€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ íˆ¬ìí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ë¶€ë™ì‚°, ì˜ˆìˆ í’ˆ, ìŒì› ë“± ë‹¤ì–‘í•œ ìì‚°ì— íˆ¬ìí•  ìˆ˜ ìˆì–´ìš”.',
                                    timestamp: new Date(Date.now() - 86350000).toISOString()
                                }
                            ]
                        },
                        {
                            id: '2',
                            timestamp: new Date(Date.now() - 172800000).toISOString(),
                            messages: [
                                {
                                    role: 'user',
                                    content: 'Tupickì˜ ì£¼ìš” ê¸°ëŠ¥ì€ ë¬´ì—‡ì¸ê°€ìš”?',
                                    timestamp: new Date(Date.now() - 172800000).toISOString()
                                },
                                {
                                    role: 'assistant',
                                    content: 'Tupickì€ AI ê¸°ë°˜ ì¡°ê°íˆ¬ì ë¶„ì„ í”Œë«í¼ìœ¼ë¡œ, ìŠ¤ë§ˆíŠ¸ ë°ì´í„° ìˆ˜ì§‘, AI ë¶„ì„, ë§ì¶¤í˜• ë¦¬í¬íŠ¸ ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.',
                                    timestamp: new Date(Date.now() - 172750000).toISOString()
                                }
                            ]
                        }
                    ];
                    displayChatList(dummyData);
                }, 1000);

            } catch (error) {
                console.error('Error:', error);
                showLoginRequired();
            }
        }

        function showLoginRequired() {
            document.getElementById('chatList').innerHTML = `
                <div class="empty-state">
                    <i>ğŸ”’</i>
                    <h3>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
                    <p>ì±„íŒ… ê¸°ë¡ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
                    <button onclick="window.location.href='login.html'" class="nav-button" style="margin-top: 15px;">
                        ë¡œê·¸ì¸í•˜ê¸°
                    </button> 
                </div>
            `;
        }

        // ì±„íŒ… ëª©ë¡ í‘œì‹œ
        function displayChatList(chatHistory) {
            const chatList = document.getElementById('chatList');

            if (!chatHistory || chatHistory.length === 0) {
                chatList.innerHTML = `
                    <div class="empty-state">
                        <i>ğŸ’¬</i>
                        <h3>ì•„ì§ ëŒ€í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ë©”ì¸ í˜ì´ì§€ì—ì„œ ì±—ë´‡ê³¼ ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
                        <button class="nav-button" onclick="window.location.href='index.html'" style="margin-top: 15px;">
                            ëŒ€í™” ì‹œì‘í•˜ê¸°
                        </button>
                    </div>
                `;
                return;
            }

            let html = '';
            chatHistory.forEach((chat, index) => {
                const firstUserMessage = chat.messages?.find(msg => msg.role === 'user');
                const preview = firstUserMessage ?
                    (firstUserMessage.content.length > 30 ?
                        firstUserMessage.content.substring(0, 30) + '...' :
                        firstUserMessage.content) :
                    'ëŒ€í™” ë‚´ìš©';

                const date = new Date(chat.timestamp);
                const formattedDate = `${date.getFullYear()}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getDate().toString().padStart(2, '0')}`;

                html += `
                    <div class="chat-item" data-chat-id="${chat.id}" onclick="selectChat('${chat.id}')">
                        <div class="chat-avatar">AI</div>
                        <div class="chat-info">
                            <div class="chat-title">ëŒ€í™” ${index + 1}</div>
                            <div class="chat-preview">${preview}</div>
                            <div class="chat-date">${formattedDate}</div>
                        </div>
                    </div>
                `;
            });

            chatList.innerHTML = html;

            // ì²« ë²ˆì§¸ ì±„íŒ… ìë™ ì„ íƒ
            if (chatHistory.length > 0) {
                selectChat(chatHistory[0].id);
            }
        }

        // ì±„íŒ… ì„ íƒ
        function selectChat(chatId) {
            // í™œì„±í™” í‘œì‹œ
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            const selectedItem = document.querySelector(`[data-chat-id="${chatId}"]`);
            if (selectedItem) {
                selectedItem.classList.add('active');
            }

            // ì±„íŒ… ë‚´ìš© ë¡œë“œ
            loadChatDetail(chatId);
        }

        // ì±„íŒ… ë‚´ìš© ë¡œë“œ
        async function loadChatDetail(chatId) {
            try {
                // ì‹¤ì œ API í˜¸ì¶œ ëŒ€ì‹  ë”ë¯¸ ë°ì´í„° ì‚¬ìš© (ê°œë°œìš©)
                setTimeout(() => {
                    const dummyChats = {
                        '1': {
                            id: '1',
                            timestamp: new Date(Date.now() - 86400000).toISOString(),
                            messages: [
                                {
                                    role: 'user',
                                    content: 'ì¡°ê°íˆ¬ìì— ëŒ€í•´ ì•Œë ¤ì£¼ì„¸ìš”',
                                    timestamp: new Date(Date.now() - 86400000).toISOString()
                                },
                                {
                                    role: 'assistant',
                                    content: 'ì¡°ê°íˆ¬ìëŠ” ê³ ê°€ì˜ ìì‚°ì„ ì‘ì€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ íˆ¬ìí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ë¶€ë™ì‚°, ì˜ˆìˆ í’ˆ, ìŒì› ë“± ë‹¤ì–‘í•œ ìì‚°ì— íˆ¬ìí•  ìˆ˜ ìˆì–´ìš”. ì£¼ìš” ì¥ì ì€ ì†Œì•¡ìœ¼ë¡œ ê³ ê°€ ìì‚°ì— íˆ¬ìí•  ìˆ˜ ìˆê³ , ë‹¤ì–‘í•œ ìì‚°ì— ë¶„ì‚° íˆ¬ìí•˜ì—¬ ë¦¬ìŠ¤í¬ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤.',
                                    timestamp: new Date(Date.now() - 86350000).toISOString()
                                },
                                {
                                    role: 'user',
                                    content: 'ì–´ë–¤ í”Œë«í¼ì´ ìˆë‚˜ìš”?',
                                    timestamp: new Date(Date.now() - 86300000).toISOString()
                                },
                                {
                                    role: 'assistant',
                                    content: 'êµ­ë‚´ì—ëŠ” KASA, TESSA, ë®¤ì§ì¹´ìš° ë“± ë‹¤ì–‘í•œ ì¡°ê°íˆ¬ì í”Œë«í¼ì´ ìˆìŠµë‹ˆë‹¤. ê° í”Œë«í¼ë§ˆë‹¤ íŠ¹í™”ëœ ìì‚°êµ°ì´ ë‹¤ë¥´ë‹ˆ ë³¸ì¸ì˜ íˆ¬ì ëª©ì ì— ë§ê²Œ ì„ íƒí•˜ì‹œëŠ” ê²ƒì´ ì¢‹ì•„ìš”.',
                                    timestamp: new Date(Date.now() - 86250000).toISOString()
                                }
                            ]
                        },
                        '2': {
                            id: '2',
                            timestamp: new Date(Date.now() - 172800000).toISOString(),
                            messages: [
                                {
                                    role: 'user',
                                    content: 'Tupickì˜ ì£¼ìš” ê¸°ëŠ¥ì€ ë¬´ì—‡ì¸ê°€ìš”?',
                                    timestamp: new Date(Date.now() - 172800000).toISOString()
                                },
                                {
                                    role: 'assistant',
                                    content: 'Tupickì€ AI ê¸°ë°˜ ì¡°ê°íˆ¬ì ë¶„ì„ í”Œë«í¼ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì£¼ìš” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:\n\n1. ìŠ¤ë§ˆíŠ¸ ë°ì´í„° ìˆ˜ì§‘: ë‹¤ì–‘í•œ í”Œë«í¼ì—ì„œ ì‹¤ì‹œê°„ ì •ë³´ ìˆ˜ì§‘\n2. AI ê¸°ë°˜ ë¶„ì„: ìì—°ì–´ ì²˜ë¦¬ ê¸°ìˆ ë¡œ íˆ¬ì ì •ë³´ ì‹¬ì¸µ ë¶„ì„\n3. ë§ì¶¤í˜• ë¦¬í¬íŠ¸: ì‚¬ìš©ì í”„ë¡œí•„ì— ë§ëŠ” íˆ¬ì ë¦¬í¬íŠ¸ ì œê³µ\n4. ë¦¬ìŠ¤í¬ í‰ê°€: íˆ¬ì ìœ„í—˜ë„ í‰ê°€ ë° ê´€ë¦¬',
                                    timestamp: new Date(Date.now() - 172750000).toISOString()
                                }
                            ]
                        }
                    };

                    const chat = dummyChats[chatId];
                    if (chat) {
                        displayChatDetail(chat);
                    } else {
                        document.getElementById('chatMessages').innerHTML = `
                            <div class="no-chat">
                                <i>âš ï¸</i>
                                <h3>ëŒ€í™”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
                                <p>ì„ íƒí•œ ëŒ€í™”ê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                            </div>
                        `;
                    }
                }, 500);

            } catch (error) {
                console.error('Error loading chat detail:', error);
                document.getElementById('chatMessages').innerHTML = `
                    <div class="no-chat">
                        <i>âš ï¸</i>
                        <h3>ì±„íŒ… ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // ì±„íŒ… ë‚´ìš© í‘œì‹œ
        function displayChatDetail(chat) {
            const chatMessages = document.getElementById('chatMessages');
            const chatTitle = document.getElementById('chatTitle');
            const chatInfo = document.getElementById('chatInfo');

            // í—¤ë” ì—…ë°ì´íŠ¸
            const date = new Date(chat.timestamp);
            const formattedDate = `${date.getFullYear()}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getDate().toString().padStart(2, '0')}`;
            const messageCount = chat.messages?.length || 0;

            chatTitle.textContent = `ëŒ€í™” (${messageCount}ê°œ ë©”ì‹œì§€)`;
            chatInfo.textContent = `${formattedDate} Â· ${messageCount}ê°œ ë©”ì‹œì§€`;

            // ë©”ì‹œì§€ í‘œì‹œ
            let html = '';
            if (chat.messages && chat.messages.length > 0) {
                chat.messages.forEach(message => {
                    const time = new Date(message.timestamp);
                    const formattedTime = `${time.getHours().toString().padStart(2, '0')}:${time.getMinutes().toString().padStart(2, '0')}`;

                    if (message.role === 'user') {
                        html += `
                            <div class="message sent">
                                <div class="message-avatar">ë‚˜</div>
                                <div class="message-content">
                                    <div class="message-text">${message.content}</div>
                                    <div class="message-time">${formattedTime}</div>
                                </div>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="message received">
                                <div class="message-avatar">AI</div>
                                <div class="message-content">
                                    <div class="message-text">${message.content}</div>
                                    <div class="message-time">${formattedTime}</div>
                                </div>
                            </div>
                        `;
                    }
                });

                // ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
                html += `
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="delete-btn" onclick="deleteChat('${chat.id}')">ì´ ëŒ€í™” ì‚­ì œ</button>
                    </div>
                `;
            } else {
                html = `
                    <div class="no-chat">
                        <i>ğŸ’¬</i>
                        <h3>ëŒ€í™” ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ì´ ëŒ€í™”ì—ëŠ” ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
            }

            chatMessages.innerHTML = html;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ì±„íŒ… ì‚­ì œ
        async function deleteChat(chatId) {
            if (!confirm('ì •ë§ ì´ ëŒ€í™”ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                // ì‹¤ì œ API í˜¸ì¶œ ëŒ€ì‹  ë”ë¯¸ ì²˜ë¦¬
                setTimeout(() => {
                    alert('ëŒ€í™”ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadChatHistory(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                }, 500);

            } catch (error) {
                console.error('Error deleting chat:', error);
                alert('ì±„íŒ… ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        document.getElementById('searchInput').addEventListener('input', function (e) {
            const searchTerm = e.target.value.toLowerCase();
            const chatItems = document.querySelectorAll('.chat-item');

            chatItems.forEach(item => {
                const preview = item.querySelector('.chat-preview')?.textContent.toLowerCase() || '';
                const title = item.querySelector('.chat-title')?.textContent.toLowerCase() || '';

                if (preview.includes(searchTerm) || title.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ì±„íŒ… ê¸°ë¡ í˜ì´ì§€ ë¡œë“œë¨');
            updateAuthUI();
            handleAuthRedirect();
            loadChatHistory();
        });
    </script>
</body>
</html>